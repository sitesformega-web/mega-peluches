<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>M√≥dulo de Vendedores - MegaShop</title>
<style>
  body {
    font-family: "Poppins", sans-serif;
    background: #f3f4f6;
    color: #111827;
    display:flex;
    align-items:center;
    justify-content:center;
    height:100vh;
    margin:0;
  }
  .container {
    background:white;
    padding:30px;
    border-radius:16px;
    box-shadow:0 4px 20px rgba(0,0,0,0.1);
    max-width:420px;
    width:90%;
  }
  h2 {
    text-align:center;
    color:#293073;
    margin-bottom:20px;
  }
  label {
    display:block;
    font-weight:600;
    margin-top:15px;
    color:#374151;
  }
  select, button {
    width:100%;
    padding:10px;
    margin-top:8px;
    border-radius:8px;
    border:1px solid #ccc;
    font-size:15px;
  }
  button {
    background:#293073;
    color:white;
    cursor:pointer;
    margin-top:20px;
    font-weight:600;
    transition:0.2s;
  }
  button:hover {
    background:#1e275a;
  }
  .output {
    margin-top:20px;
    text-align:center;
    word-wrap:break-word;
    background:#f9fafb;
    padding:10px;
    border-radius:8px;
    border:1px dashed #ccc;
  }
  .copy-btn {
    background:#2563eb;
    margin-top:10px;
  }
  .small {
    font-size:12px;
    color:#6b7280;
    margin-top:5px;
  }
</style>
</head>
<body>
<div class="container">
  <h2>üîó Generador de Enlaces</h2>

  <label for="vendedor">Vendedor:</label>
  <select id="vendedor">
    <option value="">-- Seleccion√° --</option>
  </select>

  <label for="categoria">Categor√≠a:</label>
  <select id="categoria">
    <option value="">-- Seleccion√° --</option>
  </select>
  <div class="small">Las categor√≠as vienen de las hojas del Sheet (excepto "Vendedores").</div>

  <button onclick="generarLink()">Generar enlace</button>

  <div id="resultado" class="output" style="display:none;"></div>
  <button id="copyBtn" class="copy-btn" style="display:none;" onclick="copiarLink()">üìã Copiar</button>
</div>

<script>
// üëâ TU exec actual:
const apiUrl = 'https://script.google.com/macros/s/AKfycbwqc3PKJlfYuTXZWukUixxbskmD85RXaCS1TVsGrsxxRQyiLJ2MXiYl2j_CA6BTJWv3vw/exec';

// üëâ URL base del Google Site donde viven los cat√°logos
const baseUrl = 'https://sites.google.com/view/megashop-lista';

// Solo usamos este mapa si alg√∫n d√≠a quer√©s mostrar el n√∫mero en pantalla.
// Para la l√≥gica actual NO es necesario para WhatsApp, eso lo resuelve el App Script.
let vendedoresMap = {}; // nombre ‚Üí whatsapp

// üîπ Cargar vendedores y categor√≠as desde el App Script (modo meta, sin par√°metros)
async function cargarDatos() {
  try {
    const res = await fetch(apiUrl);
    const data = await res.json();

    const vendedorSelect = document.getElementById('vendedor');
    const categoriaSelect = document.getElementById('categoria');

    // Validaciones b√°sicas
    if (!data || (!data.vendedores && !data.categorias)) {
      console.error("Respuesta inesperada del API:", data);
      alert("‚ùå No se pudieron cargar datos desde Sheets");
      return;
    }

    // üî∏ Cargar vendedores (desde hoja 'Vendedores')
    if (Array.isArray(data.vendedores)) {
      data.vendedores.forEach(v => {
        if (v.nombre && v.whatsapp) {
          vendedoresMap[v.nombre] = v.whatsapp;

          const option = document.createElement('option');
          option.value = v.nombre;
          option.textContent = v.nombre;
          vendedorSelect.appendChild(option);
        }
      });
    }

    // üî∏ Cargar categor√≠as (todas las hojas excepto 'Vendedores')
    if (Array.isArray(data.categorias)) {
      data.categorias.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        categoriaSelect.appendChild(option);
      });
    }

    // (Opcional) Restaurar √∫ltima selecci√≥n si existiera
    const vendedorGuardado = localStorage.getItem('vendedorSeleccionado');
    const categoriaGuardada = localStorage.getItem('categoriaSeleccionada');
    if (vendedorGuardado && vendedoresMap[vendedorGuardado]) {
      vendedorSelect.value = vendedorGuardado;
    }
    if (categoriaGuardada && data.categorias?.includes(categoriaGuardada)) {
      categoriaSelect.value = categoriaGuardada;
    }

  } catch (err) {
    alert("‚ùå Error al cargar datos desde Sheets");
    console.error(err);
  }
}

// üîπ Generar link con vendedor y categor√≠a
function generarLink() {
  const categoria = document.getElementById('categoria').value;
  const vendedor = document.getElementById('vendedor').value;

  if (!categoria || !vendedor) {
    alert("Seleccion√° vendedor y categor√≠a.");
    return;
  }

  // Guardamos la selecci√≥n por comodidad
  localStorage.setItem('vendedorSeleccionado', vendedor);
  localStorage.setItem('categoriaSeleccionada', categoria);

  // El slug de la categor√≠a lo hacemos en min√∫sculas.
  // Si tu p√°gina en Sites usa otro slug, despu√©s ajustamos esta parte nom√°s.
  const slugCategoria = categoria.toLowerCase();

  const link = `${baseUrl}/${encodeURIComponent(slugCategoria)}?vendedor=${encodeURIComponent(vendedor)}`;

  const resultado = document.getElementById('resultado');
  const copyBtn = document.getElementById('copyBtn');

  resultado.style.display = "block";
  copyBtn.style.display = "block";
  resultado.textContent = link;
}

// üîπ Copiar al portapapeles
function copiarLink() {
  const resultado = document.getElementById('resultado');
  if (!resultado.textContent) {
    alert("No hay enlace para copiar.");
    return;
  }
  navigator.clipboard.writeText(resultado.textContent);
  alert("‚úÖ Enlace copiado al portapapeles");
}

// Inicializamos al cargar la p√°gina
cargarDatos();
</script>
</body>
</html>
