<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catálogo Mega Peluches</title>

<!-- Fuente Lato -->
<link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">

<style>
  body {
    font-family: 'Lato', sans-serif;
    margin: 20px;
    background: #f9f9f9;
  }

  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
  }

  .product-card {
    border: 1px solid #ddd;
    border-radius: 12px;
    padding: 15px;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    background: #fff;
  }

  .product-card img {
    max-width: 100%;
    border-radius: 8px;
    margin-bottom: 10px;
  }

  .qty-container {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin: 10px 0;
  }

  .qty-container button {
    padding: 5px 10px;
    cursor: pointer;
  }

  .whatsapp-btn {
    background-color: #25D366;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-family: 'Lato', sans-serif;
    text-decoration: none;
    display: inline-block;
  }
</style>
</head>
<body>

<h1 style="text-align:center;">Catálogo Mega Peluches</h1>

<div class="product-grid" id="product-list"></div>

<script>
  // ==========================
  // CONFIGURACIÓN DEL JSON
  // ==========================
  const endpoint = "https://script.google.com/macros/s/AKfycbwOmpOo1x6NpmEvAjk0KZYC0MIPDPDxl26mbnYVjHJVdx6AhVSoXbwjsezyaJPRiYiQ2Q/exec"; // <-- reemplazá con el URL JSON generado por Apps Script

  fetch(endpoint)
    .then(response => response.json())
    .then(products => {
      const productList = document.getElementById('product-list');

      products.forEach((prod, index) => {
        let qty = 1;

        const card = document.createElement('div');
        card.className = 'product-card';
        card.innerHTML = `
          <img src="${prod.imagen}" alt="${prod.nombre}">
          <h3>${prod.nombre}</h3>
          <p>${prod.detalle}</p>
          <p>Precio Minorista: ${prod.precioMinorista} Gs</p>
          <p>Precio Mayorista: ${prod.precioMayorista} Gs</p>
          <div class="qty-container">
            <button id="minus-${index}">-</button>
            <span id="qty-${index}">${qty}</span>
            <button id="plus-${index}">+</button>
          </div>
          <a id="wa-${index}" class="whatsapp-btn" target="_blank" href="#">
            Comprar por WhatsApp
          </a>
        `;
        productList.appendChild(card);

        const qtySpan = document.getElementById(`qty-${index}`);
        const waBtn = document.getElementById(`wa-${index}`);

        const updateLink = () => {
          waBtn.href = `https://wa.me/${prod.whatsapp}?text=Hola%20quiero%20comprar%20${qty}%20${encodeURIComponent(prod.nombre)}`;
        };

        document.getElementById(`minus-${index}`).onclick = () => {
          qty = Math.max(1, qty-1);
          qtySpan.innerText = qty;
          updateLink();
        };

        document.getElementById(`plus-${index}`).onclick = () => {
          qty++;
          qtySpan.innerText = qty;
          updateLink();
        };

        updateLink(); // inicializa el link
      });
    })
    .catch(err => console.error("Error cargando productos:", err));

  // ==========================
  // Ajuste de altura para iframe en Sites
  // ==========================
  function sendHeight() {
    const height = document.body.scrollHeight;
    parent.postMessage({ frameHeight: height }, "*");
  }

  window.onload = () => { 
    sendHeight(); 
    window.addEventListener('resize', sendHeight);
  };
</script>

</body>
</html>
